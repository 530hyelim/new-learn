<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="memberMapper">

<resultMap id="memberResultSet" type="member">
    <id property="userNo" column="USER_NO"/>
    <result property="userId" column="USER_ID"/>
    <result property="userPwd" column="USER_PW"/>
    <result property="userName" column="USER_NAME"/>
    <result property="email" column="EMAIL"/>
    <result property="phone" column="PHONE"/>
    <result property="ssn" column="SSN"/>
    <result property="status" column="MEMBER_STATUS"/>
    <result property="enrollDate" column="JOIN_DATE"/>
</resultMap>


	<select id="loginMember" resultMap="memberResultSet">
		SELECT * FROM MEMBER
		WHERE USER_ID = #{userId}
			AND MEMBER_STATUS = 'Y'	
	</select>

	<insert id="insertMember">
		INSERT INTO MEMBER (
				USER_NO, USER_ID, USER_PW, USER_NAME,
				SSN, PHONE, EMAIL
		) VALUES (
				SEQ_MEMBER.NEXTVAL,
				#{userId},
				#{userPwd},
				#{userName},
				#{ssn},
				#{phone},
				#{email}
		)
	</insert>
	
	<select id="idCheck" resultType="int">
		SELECT COUNT(*) FROM MEMBER WHERE USER_ID = #{userId}
	</select>

	<select id="findId" resultType="string">
		SELECT USER_ID
		FROM MEMBER
		WHERE USER_NAME = #{userName}
		AND SSN = #{ssn}
	</select>
	
	<select id="checkNameAndSsn" resultType="int">
		SELECT COUNT(*)
		FROM MEMBER
		WHERE USER_NAME = #{userName}
			AND SSN = #{ssn}
	</select> <!-- 이름과 주민번호를 모두 만족하는 회원이 몇명인지 세어달라-->
	
	<update id="updatePassword">
		UPDATE MEMBER
			SET USER_PW = #{newPassword}
		WHERE USER_ID = #{userId}
	</update>
	
	<update id="updateMember">
		UPDATE MEMBER
			SET USER_NAME = #{userName},
				PHONE = #{phone},
				EMAIL = #{email}
			WHERE USER_ID = #{userId}
	</update>
	
	<select id="findUserForPasswordReset" resultType="string">
		SELECT USER_ID
		FROM MEMBER
		WHERE USER_NAME = #{userName}
			AND SSN = #{ssn}
			AND EMAIL = #{email}
			AND MEMBER_STATUS = 'Y'
	</select>


















	<!-- 테이블 상의해보기 <insert id="insertAuthority">
		INSERT INTO AUTHORITIES (USER_ID, AUTH) VALUES (#{userId}, 'ROLE_USER')
	</insert> -->



	<!-- <select id="loginMember" resultType="member">
		select * from member
		where user_id = #{userId}
		and user_pwd = #{userPwd}
	</select>
	
	<insert id="insertMember">
		insert into member values(
			seq_uno.nextval,
			#{userId},
			#{userPwd},
			#{userName},
			#{email},
			#{birthday},
			#{gender},
			#{phone},
			#{address},
			default,
			default,
			default,
			default
		)
	</insert>
	
	<insert id="insertAuthority">
		insert into authorities values(#{userId}, 'ROLE_USER')
	</insert>
	
	<update id="updateMember">
		update member
		<set>
			user_id = #{userId},
			user_name = #{userName},
			<if test="email != null">
				email = #{email},
			</if>
			<if test="birthday != null">
				birthday = #{birthday},
			</if>
			<if test="gender != null">
				gender = #{gender},
			</if>
			<if test="phone != null">
				phone = #{phone},
			</if>
			<if test="address != null">
				address = #{address},
			</if>
			modify_date = sysdate
		</set>
		
		where user_id = #{userId} and user_pwd = #{userPwd}
	</update>
	
	<select id="idCheck" resultType="int">
		select count(*) from member where user_id = #{userId}
	</select>
	
	<select id="selectOne" resultType="hashmap">
		select user_id, user_name from member where user_id = #{userId}
	</select> -->
	
</mapper>