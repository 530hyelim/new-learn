<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="event">
	<select id="findAllByDate" resultType="event">
		select * from calendar
		join member using(user_no)
		where trunc(start_date) = to_date(#{selectedDate}, 'YYYY-FMMM-FMDD')
			and event_type = 'SHARED'
			and visibility = 'Y'
	</select>
	
	<select id="upcomingEvents" resultType="event">
		select * from (
			select * from calendar
			join member using(user_no)
			where start_date >= sysdate
				and event_type = 'SHARED'
				and visibility = 'Y'
			order by start_date
		) where rownum <![CDATA[<=]]> 3
	</select>
	
	<select id="findByNo" resultType="event">
		select * from calendar
		where event_no = #{eventNo}
			and visibility = 'Y'
	</select>
	
	<select id="findAllPersonal" resultType="event">
		select * from calendar
		join member using(user_no)
		where trunc(start_date) = to_date(#{selectedDate}, 'YYYY-FMMM-FMDD')
			and event_type = 'PERSONAL'
			and visibility = 'Y'
	</select>
	
	<select id="joinMemberCnt" resultType="int">
		select count(*) from event_join_member
		where event_no = #{eventNo}
	</select>
	
	<insert id="insertEvent">
		insert into calendar values
		(seq_event_no.nextval, #{classNo}, #{userNo}, #{eventName}, #{startDate}, #{endDate}, 
		#{content}, #{place}, sysdate, #{eventType}, 'Y', #{numPpl}, #{joinDeadline})
	</insert>
	
	<update id="updateEvent">
		update calendar set
			event_name = #{eventName},
			start_date = #{startDate},
			end_date = #{endDate},
			content = #{content},
			place = #{place},
			num_ppl = #{numPpl},
			join_deadline = #{joinDeadline}
		where event_no = #{eventNo}
	</update>
</mapper>